name: Tri·ªÉn khai ReactJS FE l√™n Server

on:
  push:
    branches: [ "main" ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: L·∫•y m√£ ngu·ªìn
        uses: actions/checkout@v4

      - name: C√†i Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: C√†i ƒë·∫∑t th∆∞ vi·ªán FE
        working-directory: ./fe
        run: npm install

      - name: Build d·ª± √°n FE
        working-directory: ./fe
        run: npm run build

      - name: Tri·ªÉn khai FE l√™n Server qua SSH
        uses: easingthemes/ssh-deploy@v4
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_KEY }}   # private key b·∫°n ƒë√£ t·∫°o
          REMOTE_HOST: ${{ secrets.SSH_HOST }}      # IP ho·∫∑c domain server
          REMOTE_USER: ${{ secrets.SSH_USER }}      # v√≠ d·ª•: ubuntu
          SOURCE: "fe/dist/"
          TARGET: "/var/www/app"

      # üéâ Th√¥ng b√°o khi tri·ªÉn khai th√†nh c√¥ng
      - name: Th√¥ng B√°o (Th√†nh c√¥ng)
        if: success()
        run: |
          curl -H "Content-Type: application/json" \
          -d "{
            \"content\": \"‚úÖ **Tri·ªÉn khai FE th√†nh c√¥ng!**\nüìå Repository: $GITHUB_REPOSITORY\nüîß Commit: $GITHUB_SHA\nüéØ ƒê√£ deploy l√™n server /var/www/app.\"
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}

      # ‚ùó Th√¥ng b√°o khi l·ªói build ho·∫∑c deploy
      - name: Th√¥ng B√°o (Th·∫•t b·∫°i)
        if: failure()
        run: |
          curl -H "Content-Type: application/json" \
          -d "{
            \"content\": \"‚ùå **Tri·ªÉn khai FE th·∫•t b·∫°i!**\n‚ö† L·ªói trong qu√° tr√¨nh Build ho·∫∑c Deploy.\nüìå Repository: $GITHUB_REPOSITORY\n‚û° Vui l√≤ng ki·ªÉm tra l·∫°i *GitHub Actions Logs* ƒë·ªÉ bi·∫øt chi ti·∫øt.\"
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}